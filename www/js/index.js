
t_not_connected_text = ['Make sure that your Wi-Fi or cellular mobile data is turned on and then try again.', 'Upewnij się, że Wifi lub  dane komórkowe są włączone, a następnie spróbuj ponownie.', 'Asegúrate que el WiFi o datos móviles están activados e inténtalo otra vez.', 'Vergewissere dich, dass dein WLAN oder Mobilfunknetz eingeschaltet ist und versuche es dann nochmal.', 'Assurez-vous que le Wi-Fi ou les données mobiles sont activées et essayez de nouveau.'];
t_not_connected_title = ['No internet connection', 'Nie można połączyć się z internetem', 'No hay conexión a internet', 'Keine Internetverbindung', 'Pas de connexion Internet'];
t_not_connected_exit = ['OK', 'OK', 'OK', 'OK', 'OK'];
t_during_learning = ['Lesson in progress', 'W trakcie nauki', 'Lección en progreso', 'Lektion im Gange', 'Leçon en cours'];
t_lesson_skipped = ['Skipped', 'Pominięta', 'Omitida', 'Übersprungen', 'Passée'];
t_learned_lesson = ['Completed', 'Ukończona', 'Finalizada', 'Abgeschlossen', 'Terminée'];
t_recognize_error_title = ["Didn't catch that", 'Nie zrozumieliśmy', 'No lo entendemos', 'Das habe ich nicht verstanden', "Nous n'avons pas compris"];
t_recognize_error_try_again = ['Try again', 'Spróbuj ponownie', 'Inténtalo de nuevo', 'Versuche es nochmal', 'Essayez de nouveau'];
t_recognize_error_skip = ['Skip the task', 'Pomiń zadanie', 'Omitir tarea', 'Aufgabe überspringen', "Passez l'exercice"];
t_recognize_error_first_text = ['Try to speak more clearly and loudly.', 'Staraj się mówić głośno i wyraźnie.', 'Trata de hablar más alto y claro.', 'Versuche, deutlicher und lauter zu sprechen.', 'Essayez de parler plus clairement et plus fort.'];
t_recognize_error_second_text = ["Please try to say the phrase in exactly the same way as you heard it. This applies to vocabulary and contractions.", 'Postaraj się wymówić wyrażenie w taki sam sposób w jaki je usłyszałeś (dotyczy to zarówno słownictwa jak i skrótów).', 'Trata de decir la frase exactamente de la misma forma que la has oído (haz lo mismo tanto con el vocabulario como con las contracciones).', 'Bitte wiederhole den Satz genauso, wie du ihn gehört hast. Das gilt auch für Vokabeln und Kontraktionen.', "Essayez de dire la phrase dans le même ordre que vous l'avez entendu (cela s'applique au vocabulaire et aux contractions)."];
t_recognize_error_third_text = ["Remember sometimes speech recognition is not accurate.", 'Pamiętaj że czasami rozpoznawanie mowy jest niedokładne.', 'Recuerda que a veces el reconocimiento de voz no es preciso.', 'Denke daran, das die Spracherkennung manchmal nicht exakt ist.', "Souvenez- vous que parfois, le système de reconnaissance vocal n'est pas précis. Essayez à nouveau ou passez la tâche."];
t_end_new_materials_title = ["Congratulations!", "Gratulacje!", "¡Enhorabuena!", "Herzlichen Glückwunsch!", "Félicitations!"];
t_end_new_materials_text = ["You went through all the content. Now repeat the lessons to become a Pro.", "BRAK TŁUMACZENIA", "Ya has completado todo el contenido. Ahora, repite las lecciones para convertirte en un profesional.", "Du hast den gesamten Inhalt erarbeitet. Wiederhole jetzt die Lektionen, um ein Profi zu werden.", "Vous avez parcouru tout le contenu. Maintenant, répétez les leçons pour devenir un pro."];
t_end_new_materials_ok = ["OK", "OK", "OK", "OK", "OK"];
t_liked_words_added = ["Phrase has been added to Favourites.", "Fraza została dodana do ulubionych.", "Frase añadida a Favoritos.", "Der Satz wurde zu deinen Favoriten hinzugefügt.", "La phrase a été ajoutée à vos favoris."];
t_liked_words_remove = ["BRAK TŁUMACZENIA", "BRAK TŁUMACZENIA", "BRAK TŁUMACZENIA", "BRAK TŁUMACZENIA", "BRAK TŁUMACZENIA"];
t_no_audio_lesson_title = ["Audio not available.", "Nagrania audio niedostępne.", "Audio no disponible.", "Audio nicht verfügbar.", "L'audio n'est pas disponible."];
t_no_audio_lesson_text = ["This free version comes with 90 audio lessons. If you would like to get audio to all 180 lessons, upgrade to xxx Pro.", "Darmowa wersja aplikacji zawiera 90 lekcji audio. Jeśli chciałbyś otrzymać nagrania do wszystkich 180 lekcji kup xxx Pro.", "La versión gratuita de la aplicación contiene 90 lecciones de audio. Si deseas recibir las grabaciones de todas las 180 lecciones, compra xxx Pro.", "Diese kostenlose Version umfasst 90 Audiolektionen. Wenn du die Audios für alle 180 Lektionen haben möchtest, kauf dir xxx Pro.", "Cette version gratuite contient 90 leçons audios. Si vous voulez recevoir les audios pour l'ensemble des 180 leçons, achetez xxx Pro."];
t_no_audio_lesson_learn_anyway = ["Learn anyway", "Ucz się bez nagrań", "Aprender sin grabaciones", "Trotzdem lernen", "Apprenez sans audio"];
t_no_audio_lesson_upgrade = ["Upgrade", "Kup xxx Pro", "Compra xxx Pro", "xxx Pro kaufen", "Achetez xxx Pro"];
t_no_audio_lesson_skip = ["Skip lesson", "Pomiń lekcję", "Omitir lección", "Lektion überspringen", "Passez la leçon"];
t_confirm_back_in_learn_title = ["Are you sure?", "Czy jesteś pewien?", "¿Estás seguro?", "Bist du sicher?", "Etes-vous sûr?"];
t_confirm_back_in_learn_text = ["Your progress won't be saved.", "Twój postęp nie zostanie zapisany.", "Tu progreso no será guardado.", "Deine Fortschritte werden nicht gespeichert.", "Votre progrès ne sera pas sauvegardé."];
t_confirm_back_in_learn_back = ["Go back", "Wróć", "Volver", "Zurück", "Revenir en arrière"];
t_confirm_back_in_learn_cancel = ["Cancel", "Anuluj", "Cancelar", "Abbrechen", "Annulez"];
t_confirm_learn_missing_cat_title = ["Are you sure?", "Czy jesteś pewien?", "BRAK TŁUMACZENIA", "BRAK TŁUMACZENIA", "BRAK TŁUMACZENIA"];
t_confirm_learn_missing_cat_text = ["Do you want to learn previously skipped lesson?", "Lekcja została ostatnio pominięta.", "BRAK TŁUMACZENIA", "BRAK TŁUMACZENIA", "BRAK TŁUMACZENIA"];
t_confirm_learn_missing_cat_yes = ["Learn anyway", "Ucz się", "BRAK TŁUMACZENIA", "BRAK TŁUMACZENIA", "BRAK TŁUMACZENIA"];
t_confirm_learn_missing_cat_cancel = ["Cancel", "Anuluj", "BRAK TŁUMACZENIA", "BRAK TŁUMACZENIA", "BRAK TŁUMACZENIA"];
t_confirm_learn_inprogress_cat_title = ["Are you sure?", "Czy jesteś pewien?", "BRAK TŁUMACZENIA", "BRAK TŁUMACZENIA", "BRAK TŁUMACZENIA"];
t_confirm_learn_inprogress_cat_text = ["You are learning this lesson already.", "Uczysz się już tej lekcji.", "OK", "OK", "OK"];
t_confirm_learn_inprogress_cat_yes = ["Learn anyway", "Ucz się", "BRAK TŁUMACZENIA", "BRAK TŁUMACZENIA", "BRAK TŁUMACZENIA"];
t_confirm_learn_inprogress_cat_cancel = ["Cancel", "Anuluj", "BRAK TŁUMACZENIA", "BRAK TŁUMACZENIA", "BRAK TŁUMACZENIA"];
t_confirm_skip_lesson_title = ["Are you sure?", "Czy jesteś pewien?", "¿Estás seguro?", "Bist du sicher?", "Etes-vous sûr?"];
t_confirm_skip_lesson_text = ["Repetition is crucial for your long-term memory.", "Powtarzanie jest kluczowe w procesie zapamiętywania.", "La repetición tiene una importancia fundamental para la memorización a largo plazo.", "Wiederholungen sind für das Langzeitgedächtnis sehr wichtig.", "Répéter est essentiel pour la mémoire à long terme."];
t_confirm_skip_lesson_skip = ["Skip", "Pomiń", "Omitir", "Überspringen", "Passez"];
t_confirm_skip_lesson_cancel = ["Cancel", "Anuluj", "Cancelar", "Abbrechen", "Annulez"];
t_confirm_exit_title = ["Are you sure?", "Czy jesteś pewien?", "¿Estás seguro?", "Bist du sicher?", "Etes-vous sûr?"];
t_confirm_exit_text = ["Please complete the lesson before exiting. Otherwise, your progress won't be saved.", "Ukończ lekcję przed zamknięciem aplikacji.W przeciwnym wypadku postęp nie zostanie zapisany.", "Por favor, completa la lección antes de salir. De lo contrario, tu progreso no será guardado.", "Beende die Lektion, bevor du die Anwendung schließt. Sonst werden deine Fortschritte nicht gespeichert.", "Terminez la leçon avant de fermer l'application. Autrement votre progrès ne sera pas sauvegardé."];
t_confirm_exit_cancel = ["Cancel", "Anuluj", "Cancelar", "Abbrechen", "Annulez"];
t_confirm_exit_exit = ["Exit", "Wyjście", "Salir", "Beenden", "Quitter"];
t_placeholder_fuzzy_search = ["Search for lesson…", "Szukaj lekcji…", "Buscar lección….", "Lektion … suchen", "Chercher la leçon..."];
t_placeholder_hint_text = ["Click here to write your hint", "PL_Click here to write your hint", "ESP_Click here to write your hint", "DE_Click here to write your hint", "FR_Click here to write your hint"];
t_lang_rank = ["en", "pl", "es", "de", "fr"];

//trans["a"] = ["OK", "OK", "OK", "OK", "OK"];

/*translacje*/
function getTrans(key){
	if(langJSON.lang > 0){
		return key[parseInt(langJSON.lang-1)];
	}else{
		return key[0];
	}
}

var isPremium = false;
var app = {
    // Application Constructor
    initialize: function() {
        this.bindEvents();
    },
    // Bind Event Listeners
    //
    // Bind any events that are required on startup. Common events are:
    // 'load', 'deviceready', 'offline', and 'online'.
    bindEvents: function() {
        document.addEventListener('deviceready', this.onDeviceReady, false);
    },
    // deviceready Event Handler
    //
    // The scope of 'this' is the event. In order to call the 'receivedEvent'
    // function, we must explicitly call 'app.receivedEvent(...);'
	
    onDeviceReady: function() {
		alert("aaa");

		var src = '/android_asset/www/date/1.m4a';
		my_media = new Media(src, function () { }, function (err) { console.log("M: " + err.message + " - " + err.code); });

		
		if(!checkConnection()){	
			navigator.notification.confirm(
				getTrans(t_not_connected_text),
				onNoInternetConfirm,
				getTrans(t_not_connected_title),
				getTrans(t_not_connected_exit)
			);
		}else{
			startApp();
			setTextWidth();
		}
		
		document.addEventListener("resume", hideBars, false);

		
		if($( window ).width() > 600) {
			StatusBar.hide();	
		}else{
			AndroidFullScreen.immersiveMode(emptyFunctionS, emptyFunctionS);
		}
		
		document.addEventListener('onAdDismiss',function(data){
			//prepareAd();	
			removeAllProgress();
			removeAllProgress2();
			setTimeout(function(){	
				loadProgressBarToFull();
				loadProgressBarToFull2();
			}, 100);
			actionAfterCloseAd();
		});
		
		document.addEventListener('onAdLeaveApp',function(data){
			//prepareAd();
			actionAfterCloseAd();
		});
		
		document.addEventListener('onAdPresent',function(data){
			setTimeout(function(){		
				removeAllProgress();
				removeAllProgress2();
			}, 50);
			prepareAd();
		});
	
		document.addEventListener("backbutton", function (e) {
            e.preventDefault();
        }, false );
		
		setTextWidth();
		
		volumeTest();		

    },
    // Update DOM on a Received Event
    receivedEvent: function(id) {
        var parentElement = document.getElementById(id);
        var listeningElement = parentElement.querySelector('.listening');
        var receivedElement = parentElement.querySelector('.received');

        listeningElement.setAttribute('style', 'display:none;');
        receivedElement.setAttribute('style', 'display:block;');

        console.log('Received Event: ' + id);
    }
};

function emptyFunctionS(){
	console.log("jestem");
}
function hideBars() {

	if($( window ).width() > 600) {
		StatusBar.hide();	
	}else{
		AndroidFullScreen.immersiveMode(emptyFunctionS, emptyFunctionS);
	}

}
/* OBSŁUGA ŚCIEŻKI */
var mainPath;
function path(){
	var res = (cordova.file.externalDataDirectory).split('/').slice(-5);
	mainPath = (res.toString()).replace(/,/g,'/');
	return (res.toString()).replace(/,/g,'/');
}
var demoPathsrc;
function demoPath(){
	if(isPremium){
		var res = (cordova.file.externalDataDirectory).split('/').slice(-5);
		demoPathsrc = (res.toString()).replace(/,/g,'/');
		demoPathsrc = demoPathsrc.substring(0, demoPathsrc.length - 10) + "/files/";
		return demoPathsrc;
	}else{
		demoPathsrc = path();
		return demoPathsrc;
	}
}

var premiumPathsrc;
function premiumPath(){
	if(isPremium){
		premiumPathsrc = path();
		return premiumPathsrc;
	}else{
		var res = (cordova.file.externalDataDirectory).split('/').slice(-5);
		premiumPathsrc = (res.toString()).replace(/,/g,'/');
		premiumPathsrc = premiumPathsrc.substring(0, premiumPathsrc.length - 7) + "Pro/files/";
		return premiumPathsrc;
	}
}
/* END OBSŁUGA ŚCIEŻKI */

/* READ FILE3 */
function readDayF() {
    window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess3, onFSError);
}
function onFSSuccess3(fileSystem) {
    fileSystem.root.getFile(srcFile3, {create:false, exclusive:false}, gotFileEntry3, onFSError);
}
function gotFileEntry3(fileEntry) {
    fileEntry.file(gotFile3, onFSError);
}
function gotFile3(file) {
    readAsText3(file);
}
function readAsText3(file) {
  var reader = new FileReader();
  reader.onloadend = function(e) {
		res3 = e.target.result;
  };
  reader.readAsText(file);    
}
/* END READ FILE */

/* READ LANG */
function readLang() {
    window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccessLangR, onFSErrorLangR);
}
function onFSSuccessLangR(fileSystem) {
    fileSystem.root.getFile(srcLang, {create:false, exclusive:false}, gotFileEntryLangR, onFSErrorLangR);
	rootURL = fileSystem.root.toURL();
}
function gotFileEntryLangR(fileEntry) {
    fileEntry.file(gotFileLangR, onFSErrorLangR);
}
function gotFileLangR(file) {
    readAsTextLangR(file);
}
function readAsTextLangR(file) {
	var reader = new FileReader();
	reader.onloadend = function(evt) {
		resLang = evt.target.result;
	};
	reader.readAsText(file);    
}
function onFSErrorLangR(err) {
	var p = path();
	//alert("Pierwsze uruchomienie");
	//copyFirstPath();
	resLang = '{"lang":-1}';
}
/* END READ FILE */

/* READ FILE */
function readWriteFile() {
    window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, onFSError);
}
function onFSSuccess(fileSystem) {
    fileSystem.root.getFile(srcFile, {create:false, exclusive:false}, gotFileEntry, onFSError);
}
function gotFileEntry(fileEntry) {
    fileEntry.file(gotFile, onFSError);
}
function gotFile(file) {
    readAsText(file);
}
function readAsText(file) {
  var reader = new FileReader();
  reader.onloadend = function(e) {
		afterReadToLearn(e.target.result);
  };
  reader.readAsText(file);    
}
function onFSError(err) {
	var p = path();
	//alert("Ładownie...proszę czekać...");
	//copyFirstPath();
	res = "[]";
}
/* END READ FILE */

/* READ FILE2 */
function readWriteFile2() {
    window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess2, onFSError);
}
function onFSSuccess2(fileSystem) {
    fileSystem.root.getFile(srcFile2, {create:false, exclusive:false}, gotFileEntry2, onFSError);
}
function gotFileEntry2(fileEntry) {
    fileEntry.file(gotFile2, onFSError);
}
function gotFile2(file) {
    readAsText2(file);
}
function readAsText2(file) {
	var reader = new FileReader();
	reader.onloadend = function(e) {
		afterNoticeRead(e.target.result);
	};
	reader.readAsText(file);    
}
/* END READ FILE */

/* SAVE FILE */

var srcSaveTmp = false;
var srcSaveOld = false;
var srcSaveDayTmp = false;
var endTodayLesson = false;

function saveFile(){
	
	//				endLearn();
		
	srcSaveTmp = path() + "save_tmp.json";
	srcSaveOld = path() + "save_old.json";
	//renameFile(srcSave,'',srcSaveOld, renameSuccessSave);
	saveFileOld();
}

function renameSuccessSave(){
	saveFileOld();
}

function saveFileOld(){
	window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFSN2, failN);
}

function gotFSN2(fileSystem) {
	fileSystem.root.getFile(srcSaveTmp, {create: true}, gotFileEntryN2, failN);
}

function gotFileEntryN2(fileEntry) {
	fileEntry.createWriter(gotFileWriterN2, failN);
}

function gotFileWriterN2(writer) {

	writer.onwriteend = function (e) {
		renameFile(srcSaveTmp,'',srcSave, renameSuccessSaveEnd);
	};
	
	writer.write(JSON.stringify(datesJSON));
	writer.abort();
}

function renameSuccessSaveEnd(){
	//zapisz dzień
	saveFile5();
}

function failN(error) {
	//alert("error : "+error.code);
}
/* END SAVE FILE */

/* SAVE LANG */
function saveMyLang(mylang){
	langJSON.lang = mylang;
	getCatWithPos(0, 1);
	saveLang();
}
function saveLang(){
	window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFSNLang, failN);
}

function gotFSNLang(fileSystem) {
	fileSystem.root.getFile(srcLang, {create: true}, gotFileEntryLang, failN);
}

function gotFileEntryLang(fileEntry) {
	fileEntry.createWriter(gotFileWriterLang, failN);
}

function gotFileWriterLang(writer) {
	writer.onwrite = function(evt) {
		console.log("write success");
	};
	writer.write(JSON.stringify(langJSON));
	writer.abort();
}
/* END SAVE FILE */

/* SAVE FILE2 - DAY*/
function saveFile5(){
	srcSave5 = path() + "day.json";
	srcSaveDayTmp = path() + "day_tmp.json";
	saveFileDay();
}

function saveFileDay(){
	window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFSN5, failN);
}

function gotFSN5(fileSystem) {
	fileSystem.root.getFile(srcSaveDayTmp, {create: true}, gotFileEntryN5, failN);
}

function gotFileEntryN5(fileEntry) {
	fileEntry.createWriter(gotFileWriterN5, failN);
}

function gotFileWriterN5(writer) {
	writer.onwriteend = function (e) {
		renameFile(srcSaveDayTmp,'',srcSave5, renameSuccessSaveDayEnd);
	};
	
	//alert(JSON.stringify(datesJSON5));
	writer.write(JSON.stringify(datesJSON5));
	writer.abort();
}

function renameSuccessSaveDayEnd(){
	if(endTodayLesson){
		endLearn();
	}
}

/* END SAVE FILE */

/*POTRZEBNE ZMIENNE*/
var wordsInOneCat = 10;
var minCat = 7;
var countOfCycle = 2;
var countCatInFirstBigCat = 10;
var firstCycle = false;
var secondCycle = false;
var thirdCycle = false;
var srcSave = false;
var srcSave5 = false;
var srcLang = false;
var datesJSON = false;
var datesJSON5 = false;
var dayJSONwordsCopy = 0;
var learnedWordsCopy = 0;


var langJSON = JSON.parse('{"lang":-1}');
var dayJSON = false;
var toLearnJSON = [];

/*
var langJSON = JSON.parse('{"lang":2}');
var dayJSON = JSON.parse('{"day": 3, "words": 10, "km": 10, "skiped": ["1/10"], "rating": false, "theme": 1}');//false;//
var toLearnJSON = JSON.parse('[{"subid":1,"catid":1,"start":"10"}]');
*/

var dayJSONwordsCopy = dayJSON.words;
var	toLearnJSONcopyForBackBTN = JSON.parse(JSON.stringify(toLearnJSON));
var resLang = false;
var res = false;
var srcFile = false;
var res2 = false;
var srcFile2 = false;
var res3 = false;
var srcFile3 = false; 
var noticeJSON = [];
var likedJSON = [];
var isFirstCycle = true;
var startLearn = false;
var toLearn = [ -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 ];
var countWord = 0;
var countCatsToLearn = 0; //without repeatitions
var countCatsToLearnToday = 1; //with repeatitions
var countWordsToLearn = wordsInOneCat + (wordsInOneCat*2)//wordsInOneCat*2; //2 cykle w nowej kategorii po 10 słów
var learnedWords = 0;
var learnedWordsInCat = 0;
var countWordsToLearnInThisCycle = 0;
var suggestedCatPath = "";
var suggestedCatName = "";
var learnedCat = [];
var inProgressCat = [];
var missingCat = [];
var gameIsBegin = false;
var allCats = [];
var allUsedCats = [];
var allEndedCats = [];
var todayEndedCat = "";
var rootURL = "";
var lessonsJumpToFuture = 0;
var hasNewCatsToday = false;



function startApp(){
	alert("1");
}

function setTextWidth(){
	alert("2");
}

function volumeTest(){
	alert("4");
}

function checkConnection() {
	return(!(navigator.connection.type==0 || navigator.connection.type=='none'));
}


